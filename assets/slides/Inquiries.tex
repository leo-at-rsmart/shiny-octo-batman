\documentclass[xcolor=dvipsnames,14pt,professionalfonts]{beamer}
\usepackage{minted}
\usepackage{etoolbox}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[no-math]{fontspec} 
\usetheme{rsmarttrainMaing}
\usefonttheme{professionalfonts}
\usecolortheme{dolphin}

%\definecolor{foreground}{gray}{0}
%\definecolor{background}{gray}{1}
%\definecolor{keyword}{rgb}{0.2,0.2,0.8}
%\definecolor{warning}{rgb}{0.8,0.2,0.2}
%\definecolor{shadow}{gray}{0.35}
%\definecolor{hide}{gray}{0.9}
%\definecolor{figure}{rgb}{1,0.7,0}
%\definecolor{title}{rgb}{25,240,250}
\definecolor{title}{rgb}{0.09,0.30,0.38}
\definecolor{frametitle}{rgb}{1,1,1}
\definecolor{normal}{rgb}{0,0,0}

%\usecolortheme[named=keyword]{structure}

\setbeamercolor{title}{fg=title}
\setbeamercolor{frametitle}{fg=frametitle}
\setbeamercolor{section in toc}{fg=foreground}
\setbeamercolor{normal text}{bg=brown!46,fg=normal}

\setbeamerfont{structure}{family=\fontspec{Georgia},series=\bfseries} 
\setbeamerfont{subtitle}{family=\fontspec{Helvetica},series=\bfseries} 
\begin{document}

\title{KRAD Training}
\subtitle{Exercise: Inquiries}
\author[Leo]{Leo Przybylski}

\usebackgroundtemplate%
{%
    \includegraphics[width=\paperwidth,height=\paperheight]{../img/header.png}%
}

{
\usebackgroundtemplate{\includegraphics[width=\paperwidth]{../img/title.png}}%
\begin{frame}[plain]
  \titlepage
\end{frame}
}

\begin{frame}{Goals}
  \begin{itemize}
    \item Create a Lookup for the Author business object
    \item Create a Lookup for the Book business object
    \item Learn how to create and use a custom Lookupable helper
  \end{itemize}
\end{frame}

\begin{frame}{Checkout “exercise-krad-lookup” project}
  \begin{enumerate}
    \item To ensure a clean and consistent environment for everyone, we will check out a project from Subversion as a starting point.  This will essentially be a completed copy of the previous exercises.
    \item In order to get the copy of the project that you will need,
      please check out the \textbf{exercise-krad-lookup} project from the
      training Subversion repository.
    \end{enumerate}
  \end{frame}
Create an Inquiry definition in the data dictionary for the Author business object.
Create an Inquiry definition in the data dictionary for the Book business object.
Verify that the inquiries are functioning properly and are linked together successfully from the lookups.
Instructions
Get “exercise-inquiry” project
To ensure a clean and consistent environment for everyone, we will use the project from the USB drive as a starting point. This will essentially be a completed copy of the previous exercises along with some additional files to help get you started.
In order to get the copy of the project that you will need, get the exercise-inquiry project from the training USB drive.
Create Author Inquiry
As with the lookup in the previous exercise, this has already been done in the exercise-inquiry project as an example of how to create an inquiry definition.
Open Author.xml and review the bean with id Author-inquiryDefinition-parentBean at the bottom of the file.
Also notice where the inquiryDefinition is defined up top in the BusinessObjectEntry:
<property name="inquiryDefinition">
  <ref bean="Author-inquiryDefinition"/>
</property>
Launch the web application and navigate to the Author lookup.
Click search and you should see something like the following:

Notice that the “Author Id” column is now hyperlinked.  Click on one of these and it will load the Inquiry for that Author:

Create Book Inquiry
For this part of the exercise, take some time to define the Book Inquiry yourself according to the following specifications:
Include two sections on the Inquiry, one called “Book” the other called “Publishing Information”.
In the “Book” section include the following attributes:
Book Id
Title
Author Name
ISBN
Category
In the “Publishing Information” section include the following attributes:
Publisher
Publication Date
Once you have this defined in the Book.xml file, launch your web application.
Execute a search on the “Book Lookup” screen.
The results should have the “Book Id” hyperlinked.
If you click on one of these you should see something like the following:

Notice how the “Author Name” is hyperlinked here, if you click on this link it should take you to the Author Inquiry for that particular author:

\begin{frame}[fragile]{On Your Own}
If you have additional time, try creating a custom Inquirable object to use on one of your Inquiry Screens.  See the Rice javadoc for more details on what you can do with a custom Inquirable class.
To define a custom Inquirable on your Inquiry, add something similar to the following to your InquiryDefinition:
<property name="inquirableClass" 
          value="train.bookstore.bo.BookInquirableImpl"/>

Note that the easiest way to do this is to have your
BookInquirableImpl class extend from
org.kuali.rice.kns.inquiry.KualiInquirableImpl.  From there you can
override the methods that you need to in order to provide custom
behavior.
\end{frame}

\begin{frame}{Create the Author Lookup}
  \begin{enumerate}
    \item This portion of the exercise is easy since this has already been done for you in the \textbf{exercise-krad-lookup} project!
    \item Open up Author.xml and examine the addition of the \texttt{Author-LookupView} bean at the bottom of the file.
    \item Scroll to the top of the file and notice the missing
      lookupDefinition on Author-parentBean. This is something that
      was required for the KNS, but is no longer with KRAD because we
      modify the view directly now.
    \end{enumerate}
  \end{frame}

\begin{frame}{Create the Author Lookup}
  \begin{enumerate}
  \item Now open the following file in Eclipse: 
    \texttt{src/main/resources/trnapp/bookstore/BookstoreApplication.xml}
  \item Notice how a link to the Author lookup has been added here.
  \item Startup the web application using the launch script and point
    your browser to \texttt{http://localhost:8080/trnapp}
    \end{enumerate}
  \end{frame}

\begin{frame}{Create the Author Lookup}
  You should see the following:
\end{frame}

\begin{frame}{Create the Author Lookup}
  \begin{enumerate}
    \item Notice the link here labeled \textbf{Author Lookup}.  
    \item Click on this link. This will open up the Author lookup screen which should look like the following:
    \end{enumerate}
  \end{frame}

  \begin{frame}{Test the Author Lookup}
    \begin{enumerate}
    \item In order to test the Author Lookup, we need some rows in our author table.
      \item Execute \textbf{sql/insert-authors.sql} against your database.
      \item Now navigate back to the Author Lookup and click the
        \textbf{Search} button.
      \item 
      \end{enumerate}
    \end{frame}
    
    \begin{frame}{Test the Author Lookup}
      You should see the following results:
    \end{frame}
    
    \begin{frame}{Test the Author Lookup}
      \begin{enumerate}
      \item Your Author Ids may vary from those shown above.
      \item Play around with the criteria on the search to try
        different searches.  The ‘*’ character can be used as a
        wildcard.
      \end{enumerate}
    \end{frame}

    \begin{frame}{Create and Test the Book Lookup}
      \begin{enumerate}
        \item Using the Author Lookup View from Author.xml as an example, start creating a \texttt{Uif-LookupView} for the Book business object inside of the \texttt{Book.xml} file.
        \item For the lookupFields, specify:
          \begin{itemize}
            \item id
            \item title
            \item authorId
            \item category
            \item isbn
            \item publisher
            \item publicationDate
            \item 
            \end{itemize}
          \end{enumerate}
        \end{frame}

        \begin{frame}{Create and Test the Book Lookup}
          \begin{enumerate}
          \item For the resultFields, specify:
            \begin{itemize}
              \item id
            \item title
            \item authorId
            \item category
            \item isbn
            \end{itemize}
          \item Remember include the \texttt{dataObjectClass} property.
            \end{enumerate}
          \end{frame}
          
          \begin{frame}{Create and Test the Book Lookup}
            \begin{enumerate}
              \item Add a link to \texttt{BookstoreApplication.xml} for the Book Lookup (use the link already in that file for Author Lookup as an example).
              \item Write and execute some SQL to add some books to your database.  There is an example file named \texttt{insert-books.sql} in your sql directory.  It has one book in it, add some more of your choosing (they need not be accurate with respect to the authors we’ve entered so far).
              \item Start up your application and load your Book
                lookup, you should see something like the following:
              \end{enumerate}
            \end{frame}

          \begin{frame}{Create and Test the Book Lookup}
            \begin{enumerate}
            \item Take note of the following things about this screen:
              \item Author Id has a magnifying glass icon next to it.  This is called a “quickfinder” and will take you to the Author lookup where you can lookup an Author and return it.  Try it!
              \item Publication Date is split into two fields a “from”
                date and a “to” date.  This allows us to perform date
                range searches on that value.
              \item 
              \end{enumerate}
            \end{frame}
\begin{frame}[fragile]{Show Author Name in Result Set}
Seeing the id of the Author in the Book Lookup result set is not particularly useful for your customers.  Imagine that that they ask to see the Authors name instead (in the format “lastName, firstName middleName”).  To do this, follow these steps:
              \begin{enumerate}
              \item First, we need to add a getName() method to Author.java which will generate the Author’s name for us.  Add the following method:
    \begin{minted}[fontsize=\scriptsize]{java}
public String getName() {
	StringBuilder builder = new StringBuilder();
	builder.append(lastName).append(", ");
	builder.append(firstName);
	if (middleName != null && !"".equals(middleName.trim())) {
		builder.append(" ").append(middleName);
	}
	return builder.toString();
}
    \end{minted}
    \end{enumerate}
\end{frame}

\begin{frame}[fragile]{Show Author Name in Result Set}
Now, we must define the author name attribute in our Book data dictionary file.  Add the following to Book.xml:
    \begin{minted}[fontsize=\scriptsize]{xml}
<bean id="Book-author-name" parent="Book-author-name-parentBean"/>

<bean id="Book-author-name-parentBean" abstract="true" 
           parent="AttributeDefinition">
  <property name="shortLabel" value="Author Name"/>
  <property name="maxLength" value="256"/>
  <property name="validCharactersConstraint">
    <bean parent="AnyCharacterPatternConstraint" p:allowWhitespace="true"/>
  </property>
  <property name="controlField">
    <bean parent="Uif-TextControl"/>
  </property>
  <property name="name" value="author.name"/>
  <property name="label" value="Author Name"/>
</bean>
    \end{minted}
\end{frame}


\begin{frame}[fragile]{Show Author Name in Result Set}
 Be sure to add the \texttt{Book-author-name} bean to your list of attributes in your Book \texttt{DataObjectEntry}.
In the resultFields section of the lookup definition in your Book.xml file, replace the authorId attribute with author.name, as in the following:
    \begin{minted}[fontsize=\scriptsize]{xml}
<bean parent="Uif-InputField" p:propertyName="author.name" />
    \end{minted}
\end{frame}

\begin{frame}{Create and Test the Book Lookup}
  Start the application and hit the \textbf{Search} button
  on the Book lookup.  You should see something similar
  to the following:
  \end{frame}

  \begin{frame}{Create and Test the Book Lookup}
    Note that “Author Id” has been replaced by “Author Name”.
      Mission accomplished!
  \end{frame}

  \begin{frame}{Create a Custom Lookupable Helper}
    The KNS provides the ability to customize a Lookup using something
    called a “Lookupable Helper”.  To implement one of these, you
    create a class that extends from
    \texttt{org.kuali.rice.kns.lookup.KualiLookupableHelperServiceImpl}.  There
    are numerous operations and hook points available on this class
    and the \texttt{LookupableHelperService} interface in general.  Please see
    the javadocs for full details.           
\end{frame}

  \begin{frame}{Create a Custom Lookupable Helper}
    For this part of the exercise we are going to create a Lookupable
    helper which performs some validation for us in order to disallow
    the use of wildcards on the Category.  This is a bit of a
    contrived case for the purposes of a simple example of how to
    configure and use a Lookupable helper.  This is probably not
    likely something that you would want to do in an actual
    application.
  \end{frame}

  \begin{frame}{Create a Custom Lookupable Helper}
 \begin{enumerate}
 \item item Create a new package in the \texttt{src/main/java directory named trnapp.bookstore.}
 \item Create a new class in this package using the “New -> Class”
   wizard with the name \texttt{BookLookupableHelperServiceImpl}.  
 \item Have it extend from \texttt{org.kuali.rice.krad.lookup.LookupableImpl}.
 \item In the resulting class that is created, right-click and select “Source -> Override/Implement Methods…”
 \item Find the \texttt{validateSearchParameters(Map)} method under, and click the checkbox next to it.
 \item Click the “OK” button.
   \end{enumerate}
   \end{frame}

\begin{frame}[fragile]{Create a Custom Lookupable Helper}
 Implement the validateSearchParameters(Map) method as follows:
    \begin{minted}[fontsize=\scriptsize]{java}
@Override
public boolean validateSearchParameters(LookupForm form,
			Map<String, String> parameterMap) {
	String category = (String)parameterMap.get("category");
	if (category != null && !"".equals(category.trim())) {
		if (category.contains("*")) {
			GlobalVariables.getMessageMap().putError("lookupCriteria[category]", 
                    RiceKeyConstants.ERROR_CUSTOM, 
                    "Category does not support wildcards on search.");
		}
	}
	super.validateSearchParameters(parameterMap);
}
    \end{minted}
\end{frame}

\end{document}
